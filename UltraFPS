local player = game.Players.LocalPlayer

local gui = Instance.new("ScreenGui")
gui.Name = "UltraFPSGui"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 60)
frame.Position = UDim2.new(0.2, 0, 0.05, 0)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.Active = true
frame.Parent = gui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -30, 0.5, 0)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.Text = "Ultra FPS [OFF]"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.SourceSansBold
title.TextScaled = true
title.Parent = frame

local toggle = Instance.new("TextButton")
toggle.Size = UDim2.new(0.6, -5, 0.5, -5)
toggle.Position = UDim2.new(0, 5, 0.5, 0)
toggle.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
toggle.Text = "Toggle"
toggle.TextColor3 = Color3.new(1, 1, 1)
toggle.Font = Enum.Font.SourceSansBold
toggle.TextScaled = true
toggle.Parent = frame

local close = Instance.new("TextButton")
close.Size = UDim2.new(0.3, -5, 0.5, -5)
close.Position = UDim2.new(0.7, 0, 0.5, 0)
close.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
close.Text = "X"
close.TextColor3 = Color3.new(1, 1, 1)
close.Font = Enum.Font.SourceSansBold
close.TextScaled = true
close.Parent = frame

local fpsEnabled = false
local optimized = {}


local function OptimizeObject(v)
	if optimized[v] then return end
	optimized[v] = true

	if v:IsA("BasePart") then
		pcall(function()
			v.Material = Enum.Material.Plastic
			v.Color = Color3.fromRGB(180,180,180)
			v.Reflectance = 0
			v.CastShadow = false
		end)
	end

local function SmartHidePart(v)
	if not v:IsA("BasePart") then return end
	if v:IsDescendantOf(game.Players.LocalPlayer.Character) then return end
	
	local s = v.Size
	if s.X < 0.4 or s.Y < 0.4 or s.Z < 0.4 then
		v.Transparency = 1
		v.CanCollide = false
		return
	end
	
	if v.Transparency > 0 then
		v.Transparency = 1
		v.CanCollide = false
		return
	end
	
	if v.Name:lower():find("decor") or v.Name:lower():find("grass") or v.Name:lower():find("tree") or v.Name:lower():find("rock") then
		v.Transparency = 1
		v.CanCollide = false
		return
	end
	
	if v.Material == Enum.Material.Neon or v.Material == Enum.Material.Glass then
		v.Material = Enum.Material.Plastic
		v.Transparency = 0
		return
	end
	
	if not v.CanCollide and v.Anchored then
		v.Transparency = 1
		return
	end
end

	if v:IsA("MeshPart") then
		pcall(function()
			v.TextureID = ""
			v.Material = Enum.Material.Plastic
			v.Color = Color3.fromRGB(180,180,180)
		end)
	end

	if v:IsA("Decal") or v:IsA("Texture") then
		pcall(function() v.Transparency = 1 end)
	end

	for _, c in ipairs(v:GetChildren()) do
		if c:IsA("SurfaceAppearance") then
			pcall(function() c:Destroy() end)
		end
	end

	if v:IsA("SpecialMesh") or v:IsA("FileMesh") then
		pcall(function() v.TextureId = "" end)
	end

	if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam")
	or v:IsA("Smoke") or v:IsA("Sparkles") then
		pcall(function()
			v.Enabled = false
			if v:IsA("ParticleEmitter") then
				v.Rate = 0
				v.Lifetime = NumberRange.new(0)
			end
		end)
	end

	if v:IsA("Explosion") then
		pcall(function()
			v.BlastPressure = 1
			v.BlastRadius = 1
		end)
	end
end

local function OptimizeUI()
	for _, ui in pairs(game:GetDescendants()) do
		if ui:IsA("UIStroke") or ui:IsA("UIGradient") or ui:IsA("UIShadow") then
			pcall(function() ui:Destroy() end)
		end
	end
end

local function OptimizeCharacter(char)
	for _, v in pairs(char:GetDescendants()) do

		if v:IsA("Accessory") or v:IsA("Hat") then
			pcall(function() v:Destroy() end)
		end
		
		if v:IsA("Animator") then
			pcall(function() v:Destroy() end)
		end
	
		if v:IsA("ParticleEmitter") then
			pcall(function() v.Enabled = false end)
		end
		
		if v:IsA("Trail") then
			pcall(function() v.Enabled = false end)
		end
	end
end

local function OptimizePhysics()
	
	pcall(function()
		settings().Physics.ThrottleAdjustTime = 5
		settings().Physics.AllowSleep = true
		settings().Physics.PhysicsEnvironmentalThrottle = Enum.EnviromentalPhysicsThrottle.Always
	end)
end

local function ShadowsOff()
	for _, v in pairs(game.Workspace:GetDescendants()) do
		if v:IsA("BasePart") then
			pcall(function() v.CastShadow = false end)
		end
	end
end


local function OptimizeBloxFruitsFX()
	for _, obj in ipairs(game:GetDescendants()) do
	
		if obj:IsA("Trail") then
			pcall(function() obj.Enabled = false end)
		end

	
		if obj:IsA("ParticleEmitter") or obj:IsA("Beam") then
			pcall(function()
				obj.Enabled = false
				if obj:IsA("ParticleEmitter") then
					obj.Rate = 0
					obj.Lifetime = NumberRange.new(0)
				end
			end)
		end

		
		if obj:IsA("PointLight") or obj:IsA("SpotLight") or obj:IsA("SurfaceLight") or obj:IsA("SpotLight") then
			pcall(function() obj.Enabled = false end)
		end

		if obj:IsA("MeshPart") then
			pcall(function()
				obj.TextureID = ""
				obj.Material = Enum.Material.Plastic
				obj.Color = Color3.fromRGB(160,160,160)
			end)
		end

		if obj:IsA("Decal") or obj:IsA("Texture") then
			pcall(function() obj.Transparency = 1 end)
		end

		if obj:IsA("Attachment") then
			local children = obj:GetChildren()
			if #children > 0 then
				for _, ch in ipairs(children) do
					if ch:IsA("ParticleEmitter") or ch:IsA("Beam") or ch:IsA("Trail") then
						pcall(function() ch.Enabled = false end)
					end
				end
			end
		end
	end
end

local function OptimizeBloxFruitsSea()
	local success, t = pcall(function() return workspace:FindFirstChild("Terrain") end)
	if success and t then
		pcall(function()
			t.WaterWaveSize = 0
			t.WaterWaveSpeed = 0
			t.WaterReflectance = 0
			t.WaterTransparency = 1
		end)
	end
end

local function OptimizeNPCs()
	for _, npc in ipairs(workspace:GetDescendants()) do
		if npc:IsA("Accessory") or npc:IsA("Hat") then
			pcall(function() npc:Destroy() end)
		end
		if npc:IsA("ParticleEmitter") or npc:IsA("Beam") or npc:IsA("Trail") then
			pcall(function() npc.Enabled = false end)
		end
	end
end

local function AutoCleanLoop()
	while fpsEnabled do
		task.wait(10)
		collectgarbage("collect")
		task.wait(0.1)
	end
end



local function OptimizeGame()
	local g = game
	local w = g.Workspace
	local l = g.Lighting


	local t = w:FindFirstChild("Terrain")
	if t then
		pcall(function()
			t.WaterWaveSize = 0
			t.WaterWaveSpeed = 0
			t.WaterReflectance = 0
			t.WaterTransparency = 1
		end)
	end

	pcall(function()
		l.GlobalShadows = false
		l.FogEnd = 9e9
		l.Brightness = 0
	end)

	pcall(function() settings().Rendering.QualityLevel = Enum.QualityLevel.Level01 end)

	for _, v in pairs(g:GetDescendants()) do
		pcall(function() OptimizeObject(v) end)
	end

	for _, e in pairs(l:GetChildren()) do
		if e:IsA("BlurEffect") or e:IsA("SunRaysEffect")
		or e:IsA("ColorCorrectionEffect") or e:IsA("BloomEffect")
		or e:IsA("DepthOfFieldEffect") then
			pcall(function() e.Enabled = false end)
		end
	end

	OptimizeUI()
	OptimizePhysics()
	ShadowsOff()
	OptimizeBloxFruitsFX()
	OptimizeBloxFruitsSea()
	OptimizeNPCs()

	task.spawn(AutoCleanLoop)
end
game.DescendantAdded:Connect(function(v)
	if fpsEnabled then
		pcall(function() OptimizeObject(v) end)
		pcall(function() 
	
			if v:IsA("Trail") or v:IsA("ParticleEmitter") or v:IsA("Beam") or v:IsA("PointLight") then
				pcall(function()
					if v:IsA("Trail") or v:IsA("Beam") or v:IsA("ParticleEmitter") then
						v.Enabled = false
					else
						v.Enabled = false
					end
				end)
			end
		end)
	end
end)

player.CharacterAdded:Connect(function(char)
	if fpsEnabled then
		task.wait(1)
		
		for _, v in pairs(char:GetDescendants()) do
			pcall(function() OptimizeObject(v) end)
		end
		OptimizeCharacter(char)
	end
end)

for _, pl in ipairs(game.Players:GetPlayers()) do
	if pl.Character then
		pcall(function()
			for _, v in pairs(pl.Character:GetDescendants()) do
				OptimizeObject(v)
			end
		end)
	end
end


local function ToggleFPS()
	fpsEnabled = not fpsEnabled
	if fpsEnabled then
		title.Text = "Ultra FPS [ON]"
		OptimizeGame()
	else
		title.Text = "Ultra FPS [OFF]"

	end
end

toggle.MouseButton1Click:Connect(ToggleFPS)
close.MouseButton1Click:Connect(function() frame.Visible = false end)



local UserInputService = game:GetService("UserInputService")
local dragging, dragInput, dragStart, startPos

local function update(input)
	local delta = input.Position - dragStart
	frame.Position = UDim2.new(
		startPos.X.Scale, startPos.X.Offset + delta.X,
		startPos.Y.Scale, startPos.Y.Offset + delta.Y
	)
end

frame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

frame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		update(input)
	end
end)


task.spawn(function()
	while true do
		if fpsEnabled then
			collectgarbage("collect")

			
			for _, v in pairs(workspace:GetDescendants()) do
				if v:IsA("Explosion") or v:IsA("Sparkles") or v:IsA("Fire") then
					pcall(function() v.Enabled = false end)
				end
				if v:IsA("ParticleEmitter") then
					pcall(function()
						v.Rate = 0
						v.Lifetime = NumberRange.new(0)
					end)
				end
			end

			
			pcall(function()
				game:GetService("Debris"):AddItem(Instance.new("Folder"), 0)
			end)

			
			for _, p in pairs(game.Players:GetPlayers()) do
				if p:FindFirstChild("PlayerGui") then
					for _, g in pairs(p.PlayerGui:GetDescendants()) do
						if g:IsA("ImageLabel") or g:IsA("ImageButton") then
							if g.Image ~= "" then
								g.Image = "" 
							end
						end
					end
				end
			end
		end
		task.wait(10)
	end
end)
